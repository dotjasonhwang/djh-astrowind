---
import client from '~/data/client.json';
import { formatTime, isBusinessOpen, getTodaysHours } from '~/utils/utils';

interface Props {
  compact?: boolean;
  showStatus?: boolean;
}

const { compact = false, showStatus = true } = Astro.props;

const daysOrder = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
const dayLabels = {
  monday: 'Mon',
  tuesday: 'Tue',
  wednesday: 'Wed',
  thursday: 'Thu',
  friday: 'Fri',
  saturday: 'Sat',
  sunday: 'Sun',
};

function isCurrentDay(day: string): boolean {
  const today = new Date().toLocaleDateString('en-US', { weekday: 'short' }).toLowerCase();
  const dayMap: { [key: string]: string } = {
    sun: 'sunday',
    mon: 'monday',
    tue: 'tuesday',
    wed: 'wednesday',
    thu: 'thursday',
    fri: 'friday',
    sat: 'saturday',
  };
  return dayMap[today] === day;
}

function getCurrentStatus() {
  const isOpen = isBusinessOpen(client.businessHours);
  const hours = getTodaysHours(client.businessHours);
  const status = isOpen ? 'Open Now' : 'Closed';

  return { status, isOpen, hours: hours !== 'Closed' ? hours : undefined };
}

const currentStatus = getCurrentStatus();
---

<div class={`business-hours font-sans ${compact ? 'compact' : ''}`}>
  {
    showStatus && (
      <div
        class={`flex items-center gap-2 mt-4 px-3 py-2 rounded border font-semibold text-sm ${
          currentStatus.isOpen
            ? 'bg-green-800 text-green-100 border-green-600'
            : 'bg-red-800 text-red-100 border-red-600'
        }`}
      >
        <span>{currentStatus.status}</span>
        {currentStatus.hours && <span class="opacity-80 text-xs">{currentStatus.hours}</span>}
      </div>
    )
  }

  {
    !compact && (
      <div class="hours-list">
        <h3 class="text-lg font-bold mt-3 text-gray-900 dark:text-white">Business Hours</h3>
        <ul class="flex flex-col gap-2">
          {daysOrder.map((day) => {
            const dayHours = client.businessHours[day];
            const isClosed = dayHours.closed;
            const isToday = isCurrentDay(day);

            return (
              <li
                class={`flex justify-between items-center py-2 border-b border-gray-200 dark:border-gray-700 ${
                  isToday ? 'bg-gray-50 dark:bg-gray-800 px-3 rounded font-semibold' : ''
                }`}
              >
                <span class="text-sm text-gray-700 dark:text-gray-300">{dayLabels[day]}</span>
                <span
                  class={`text-sm font-medium ${
                    isClosed ? 'text-gray-500 dark:text-gray-400 italic' : 'text-gray-900 dark:text-white'
                  }`}
                >
                  {isClosed ? 'Closed' : `${formatTime(dayHours.open)} - ${formatTime(dayHours.close)}`}
                </span>
              </li>
            );
          })}
        </ul>
      </div>
    )
  }
</div>

{/* Dark mode status colors for better visibility */}
<style>
  .business-hours.compact .flex {
    margin-bottom: 0;
  }

  /* Enhanced dark mode colors */
  :global(.dark) .business-hours .bg-green-800 {
    background-color: rgba(34, 197, 94, 0.2);
    color: #86efac;
    border-color: rgba(34, 197, 94, 0.3);
  }

  :global(.dark) .business-hours .bg-red-800 {
    background-color: rgba(239, 68, 68, 0.2);
    color: #fca5a5;
    border-color: rgba(239, 68, 68, 0.3);
  }
</style>
